import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="CLI Reference" />

# CLI Reference

Complete reference for the myOperator UI command-line interface.

---

## Installation

The CLI is available via npx - no global installation needed:

```bash
npx myoperator-ui [command]
```

To ensure you're using the latest version:

```bash
npx myoperator-ui@latest [command]
```

To test beta versions (pre-release features):

```bash
npx myoperator-ui@beta [command]
```

---

## Commands

### `init` - Initialize Project

Set up myOperator UI in your project.

```bash
npx myoperator-ui init
```

**What it does:**
- Creates a `components.json` configuration file
- Sets up the utils file with the `cn` helper
- Creates the components directory (`src/components/ui`)
- Creates the theme file (`src/lib/myoperator-ui-theme.css`) with CSS variables
- Creates/updates your global CSS with Tailwind imports
- Configures Tailwind with `tw-` prefix (for Bootstrap compatibility)

**For existing projects:**

If `components.json` already exists, you'll see options:
- **"Update missing files only"** - Creates missing theme/CSS files without changing your config
- **"Overwrite everything"** - Full re-initialization
- **"Cancel"** - Exit without changes

This is useful when you need to add missing theme files or update CSS without losing your existing configuration.

---

### `add` - Add Components

Add components to your project.

```bash
# Add a specific component
npx myoperator-ui add button

# Add multiple components
npx myoperator-ui add button badge table

# Add ALL available components
npx myoperator-ui add --all

# Interactive selection (shows all available components)
npx myoperator-ui add
```

**Options:**

<table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '1.5rem' }}>
  <thead>
    <tr style={{ borderBottom: '2px solid #E5E7EB' }}>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Option</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Short</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--all</code></td>
      <td style={{ padding: '0.75rem' }}><code>-a</code></td>
      <td style={{ padding: '0.75rem' }}>Add all available components</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--yes</code></td>
      <td style={{ padding: '0.75rem' }}><code>-y</code></td>
      <td style={{ padding: '0.75rem' }}>Skip confirmation prompt</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--overwrite</code></td>
      <td style={{ padding: '0.75rem' }}><code>-o</code></td>
      <td style={{ padding: '0.75rem' }}>Overwrite existing files</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--path &lt;path&gt;</code></td>
      <td style={{ padding: '0.75rem' }}><code>-p</code></td>
      <td style={{ padding: '0.75rem' }}>Custom path (default: <code>src/components/ui</code>)</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--category &lt;cat&gt;</code></td>
      <td style={{ padding: '0.75rem' }}><code>-c</code></td>
      <td style={{ padding: '0.75rem' }}>Filter by category: <code>core</code>, <code>form</code>, <code>data</code>, <code>overlay</code>, <code>feedback</code>, <code>layout</code>, <code>custom</code></td>
    </tr>
  </tbody>
</table>

**Examples:**

```bash
# Add all components at once
npx myoperator-ui add --all

# Add all components, skip confirmation
npx myoperator-ui add --all -y

# Overwrite existing component
npx myoperator-ui add button --overwrite

# Add to custom directory
npx myoperator-ui add button -p src/ui

# Add all form components
npx myoperator-ui add --all --category form

# Add all custom components (complex, multi-file components)
npx myoperator-ui add --all --category custom
```

---

### `update` - Update Components

Safely update installed components to the latest version with diff preview.

> **Important:** Always use `@latest` to ensure you get the newest component code.

```bash
# Update a specific component
npx myoperator-ui@latest update button

# Update multiple components
npx myoperator-ui@latest update button badge

# Update all installed components
npx myoperator-ui@latest update --all

# Interactive selection (shows installed components)
npx myoperator-ui@latest update
```

**Options:**

<table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '1.5rem' }}>
  <thead>
    <tr style={{ borderBottom: '2px solid #E5E7EB' }}>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Option</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Short</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--all</code></td>
      <td style={{ padding: '0.75rem' }}><code>-a</code></td>
      <td style={{ padding: '0.75rem' }}>Update all installed components</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--yes</code></td>
      <td style={{ padding: '0.75rem' }}><code>-y</code></td>
      <td style={{ padding: '0.75rem' }}>Skip confirmation prompt</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--dry-run</code></td>
      <td style={{ padding: '0.75rem' }}><code>-d</code></td>
      <td style={{ padding: '0.75rem' }}>Preview changes without modifying files</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--backup</code></td>
      <td style={{ padding: '0.75rem' }}><code>-b</code></td>
      <td style={{ padding: '0.75rem' }}>Create backup files before updating</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--path &lt;path&gt;</code></td>
      <td style={{ padding: '0.75rem' }}><code>-p</code></td>
      <td style={{ padding: '0.75rem' }}>Custom path (default: <code>src/components/ui</code>)</td>
    </tr>
  </tbody>
</table>

**Examples:**

```bash
# Preview what would change (safe - no modifications)
npx myoperator-ui@latest update button --dry-run

# Preview all component updates
npx myoperator-ui@latest update --all --dry-run

# Update all with backups
npx myoperator-ui@latest update --all --backup

# Force update without confirmation
npx myoperator-ui@latest update button -y
```

**Update Safeguards:**
- Shows diff of changes before applying
- `--dry-run` lets you preview without making changes
- `--backup` creates timestamped backups (e.g., `button.tsx.backup.1700000000`)
- Only updates components that are already installed
- Skips components with no changes

---

### `sync` - Sync All Components

Automatically add new components and update existing ones in a single command. This is the recommended way to keep your project up-to-date.

> **Recommended:** Use `sync` instead of manually running `add` and `update` separately.

```bash
# Sync all components (add new + update existing)
npx myoperator-ui@latest sync

# Sync without confirmation prompts
npx myoperator-ui@latest sync -y
```

**What it does:**
1. Scans all available components in the registry
2. Identifies components not yet installed → **adds them**
3. Identifies installed components with updates → **updates them**
4. Shows a summary before making changes
5. Installs internal dependencies automatically
6. **Auto-fixes Tailwind config** when custom components are installed

**Options:**

<table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '1.5rem' }}>
  <thead>
    <tr style={{ borderBottom: '2px solid #E5E7EB' }}>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Option</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Short</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--yes</code></td>
      <td style={{ padding: '0.75rem' }}><code>-y</code></td>
      <td style={{ padding: '0.75rem' }}>Skip confirmation prompt</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>--path &lt;path&gt;</code></td>
      <td style={{ padding: '0.75rem' }}><code>-p</code></td>
      <td style={{ padding: '0.75rem' }}>Custom path (default: <code>src/components/ui</code>)</td>
    </tr>
  </tbody>
</table>

**Example output:**

```
  Scanning for 32 components...

  Summary:
    New components to add: 5
    Components to update: 2
    Already up to date: 25

  Will add:
    + alert-configuration
    + endpoint-details
    + payment-summary
    + bank-details
    + wallet-topup

  Will update:
    ~ button
    ~ dialog

  ? Proceed with 5 additions and 2 updates? (Y/n)
```

**Sync vs Update:**
- `sync` adds **new** components + updates **existing** ones
- `update` only updates components already in your project
- Use `sync` to stay current with the full component library

---

### `fix` - Fix Configuration

Diagnose and fix configuration issues without re-initializing your project.

```bash
# Check and fix configuration issues
npx myoperator-ui fix
```

**What it does:**
1. Checks if Tailwind config has required content paths
2. Adds missing paths (e.g., `src/components/custom/` for custom components)
3. Warns about missing theme files or outdated configurations
4. Preserves your existing configuration (non-destructive)

> **Note:** The `add` and `sync` commands automatically fix Tailwind config when installing custom components. Use `fix` for diagnostics or if you manually copied components.

**When to use:**
- As a diagnostic tool to check configuration health
- After manually copying component files (not using CLI)
- When styles aren't applying and you're unsure why

**Example output:**

```
  myOperator UI - Fix Configuration

  ✓ Updated tailwind.config.js with custom components path
  ✓ Configuration looks good!

  ℹ Tailwind prefix: "tw-"
```

---

### Help Commands

```bash
# Check CLI version
npx myoperator-ui --version

# Get help
npx myoperator-ui --help
npx myoperator-ui add --help
npx myoperator-ui update --help
```

---

## Configuration

After running `init`, a `components.json` file is created in your project root:

```json
{
  "$schema": "https://myoperator.com/schema.json",
  "style": "default",
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/App.scss",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": "tw-"
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui"
  }
}
```

### Configuration Options

<table style={{ width: '100%', borderCollapse: 'collapse', marginBottom: '1.5rem' }}>
  <thead>
    <tr style={{ borderBottom: '2px solid #E5E7EB' }}>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Option</th>
      <th style={{ textAlign: 'left', padding: '0.75rem', fontWeight: '600' }}>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>tailwind.prefix</code></td>
      <td style={{ padding: '0.75rem' }}>CSS class prefix (default: <code>tw-</code>) for Bootstrap compatibility</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>tailwind.css</code></td>
      <td style={{ padding: '0.75rem' }}>Path to your global CSS file</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>tailwind.config</code></td>
      <td style={{ padding: '0.75rem' }}>Path to your Tailwind config file</td>
    </tr>
    <tr style={{ borderBottom: '1px solid #E5E7EB' }}>
      <td style={{ padding: '0.75rem' }}><code>aliases.ui</code></td>
      <td style={{ padding: '0.75rem' }}>Path alias for UI components</td>
    </tr>
  </tbody>
</table>

---

## Bootstrap Compatibility

myOperator UI automatically detects if your project uses Bootstrap and configures Tailwind CSS to avoid conflicts.

### How it works

When Bootstrap is detected, the CLI:
1. Uses selective Tailwind imports (skips Preflight/reset)
2. Applies a `tw-` prefix to all Tailwind classes
3. Scopes Tailwind to only scan the components directory

### Generated CSS for Bootstrap projects

```css
/* Selective imports to avoid Preflight conflicts with Bootstrap */
@layer theme, base, components, utilities;
@import "tailwindcss/theme.css" layer(theme);
@import "tailwindcss/utilities.css" layer(utilities);

/* Tell Tailwind to scan component files for utility classes */
@source "./components/**/*.{js,ts,jsx,tsx}";
@source "./lib/**/*.{js,ts,jsx,tsx}";
```

---

## Troubleshooting

### Component styles not applying

Make sure you've installed the required dependencies:

```bash
npm install clsx tailwind-merge class-variance-authority @radix-ui/react-slot lucide-react
```

### Styles conflict with Bootstrap

If Bootstrap styles override your components:

1. Run `npx myoperator-ui init` after adding Bootstrap
2. Verify the CSS file has selective imports (not `@import "tailwindcss"`)
3. Check that `components.json` has `"prefix": "tw-"`

### PostCSS Error

If you see:

```
[plugin:vite:css] [postcss] It looks like you're trying to use `tailwindcss` directly as a PostCSS plugin.
```

Fix it:

```bash
npm install -D @tailwindcss/postcss
npx myoperator-ui init  # Recreates correct config
```

### Version mismatch / No changes showing

To ensure you're using the latest version:

```bash
npx myoperator-ui@latest update --all
```

NPX may cache older versions - always use `@latest` for updates.

---

## Next Steps

- **[Getting Started →](?path=/docs/getting-started--docs)** - Quick setup guide
- **[MCP Server →](?path=/docs/mcp-server--docs)** - AI-powered component generation
- Browse components in the sidebar
